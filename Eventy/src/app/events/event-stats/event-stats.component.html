<div style = "background-color: #F1F1F1; width: 100%;">
  <div  id = "event_filters" class = "sticky_container">
    <div style = "cursor: pointer; display: flex; flex-direction: row; justify-content: space-between; margin-left: 30px; margin-right: 30px; padding-top: 20px;">
      <div style = "display: flex; justify-content: center; align-items: center;">
        <p style = "font-size: 20px; letter-spacing: 1px; margin: 0; color: #A0A0A0; font-family: Albert Sans;">Filters</p>
      </div>
      <div class = "resetFilterContainer" (click)="resetFilters()">
        <mat-icon style = "color: white; font-size: 23px; margin-right: 5px; margin-top: 1px;">delete_outline</mat-icon>
        <p style = "margin: 0; color: white; font-family: Albert Sans; font-weight: 500">Reset All</p>
      </div>
    </div>

    <div style = "height: 2px; background-color: #F1F1F1; width: 100%; margin-top: 15px;"></div>

    <div class = "input_container" style = "margin-top: 15px">
      <div style = "width: 26vw; display: flex; justify-content: flex-start;">
        <p class = "input_label">Event types:</p>
      </div>
      <mat-form-field>
        <mat-select [formControl]="eventTypes" multiple>
          <mat-option value="Wedding">Wedding</mat-option>
          <mat-option value="Sport">Sport</mat-option>
          <mat-option value="Conference">Conference</mat-option>
          <mat-option value="Party">Party</mat-option>
          <mat-option value="Prom">Prom</mat-option>
          <mat-option value="Big Party">Big Party</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class = "input_container">
      <div style = "width: 26vw; display: flex; justify-content: flex-start;">
        <p class = "input_label">Max participants:</p>
      </div>
      <mat-form-field class="example-full-width">
        <input type="number" matInput [(ngModel)]="maxParticipantsValue" min = "1" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
      </mat-form-field>
    </div>

    <div class = "input_container">
      <div style = "width: 26vw; display: flex; justify-content: flex-start;">
        <p class = "input_label">Location:</p>
      </div>
      <form class="example-form">
        <mat-form-field>
          <input type="text"
                 matInput
                 [formControl]="locations"
                 [matAutocomplete]="auto">
          <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
            @for (locationOption of filteredLocationOptions | async; track locationOption) {
              <mat-option [value]="locationOption">{{locationOption}}</mat-option>
            }
          </mat-autocomplete>
        </mat-form-field>
      </form>
    </div>

    <div id = "events_calendar_filter" class = "input_container">
      <div style = "width: 26vw; display: flex; justify-content: flex-start;">
        <p class = "input_label">Date range:</p>
      </div>
      <form [formGroup]="dateRangeForm">
        <mat-form-field>
          <mat-label>Enter a date range</mat-label>
          <mat-date-range-input [rangePicker]="picker" formGroupName="dateRange">
            <input formControlName="start" matStartDate placeholder="Start date">
            <input formControlName="end" matEndDate placeholder="End date">
          </mat-date-range-input>
          <mat-hint style = "color: #C4C2C2 !important">MM/DD/YYYY - MM/DD/YYYY</mat-hint>
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
      </form>
    </div>

    <div style = "display: flex; justify-content: center; margin-top: 25px;">
      <div class = "confirm_filter_container" (click) = "filterEvents()">
        <p style = "font-size: 18px; margin: 0; color: white; font-weight: 600; font-family: Albert Sans;">FILTER</p>
      </div>
    </div>
  </div>

  <div class = "container">

    <!-- SEARCH & FILTER -->
    <div class = "search_and_filter_container">
      <div class = "search_container">
        <input
          class = "search_form"
          placeholder="Search.."
          [(ngModel)]="searchQuery"
          (input)="onSearchInput()">
        <div class = "search_icon_container" (click)="applySearchAndFilters()">
          <mat-icon style = "font-size: 26px; cursor: pointer;">search</mat-icon>
        </div>
      </div>

      <div class = "filter_container">
        <div style = "display: flex; flex-direction: row; color: #8F8B8B; margin-left: 5px; font-size: 18px;">
          <p style = "font-weight: 450; margin-right: 5px; font-family: Albert Sans;">Result for:</p>
          <p style = "font-weight: 450; margin-right: 5px; font-family: Albert Sans; text-decoration: underline 2px #808AAC; text-underline-offset: 3px;">events</p>
          <p style = "font-weight: 450; font-family: Albert Sans;">...</p>
        </div>

        <div id = "all_events" style = "display: flex; flex-direction: row; align-items: center; color: #8F8B8B; margin-left: 50px;">
          <p style = "font-weight: 450; margin: 0; margin-top: -13px; margin-right: 10px; font-family: Albert Sans;">Sort by:</p>
          <mat-form-field>
            <mat-select [(value)]="sortValue" (selectionChange)="onSortChange($event)">
              <mat-option [value]="'type'">Event Type</mat-option>
              <mat-option [value]="'name'">Name</mat-option>
              <mat-option [value]="'maxNumberParticipants,asc'">Max Participants (ASC)</mat-option>
              <mat-option [value]="'maxNumberParticipants,desc'">Max Participants (DESC)</mat-option>
              <mat-option [value]="'location'">Location</mat-option>
              <mat-option [value]="'date,asc'">Date (ASC)</mat-option>
              <mat-option [value]="'date,desc'">Date (DESC)</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </div>

    <!-- ALL EVENTS -->
    <div *ngFor="let event of paginatedEvents;">
      <div
        style = "margin: 6px; border: 4px solid #F1F1F1"
      >
        <app-event-card
          [eventCard]="event.eventCard"
        />
        <div class="stats">
          <ngx-charts-gauge
            [view]="[250, 250]"
            [results]="[{ name: 'Number of Guests', value: event.visitors }]"
            [scheme]="'cool'"
            [min]="0"
            [max]="event.eventCard.maxNumberParticipants"
            [units]="'people'"
            [angleSpan]="240"
            [startAngle]="-120">
          </ngx-charts-gauge>
          <ngx-charts-bar-vertical
            [view]="[250, 250]"
            [scheme]="'cool'"
            [results]="[
      { 'name': '1 Star', 'value': event.gradeDistribution[0] },
      { 'name': '2 Stars', 'value': event.gradeDistribution[1] },
      { 'name': '3 Stars', 'value': event.gradeDistribution[2] },
      { 'name': '4 Stars', 'value': event.gradeDistribution[3] },
      { 'name': '5 Stars', 'value': event.gradeDistribution[4] }
    ]"
            [gradient]="false"
            [xAxis]="true"
            [yAxis]="true"
            [legend]="false"
            [xAxisLabel]="'Stars Given'"
            [yAxisLabel]="'Number of People'"
            [barPadding]="8">
          </ngx-charts-bar-vertical>
          <ngx-charts-gauge
            [view]="[250, 250]"
            [results]="[{ name: 'Average Grade', value: event.averageGrade }]"
            [scheme]="'cool'"
            [min]="0"
            [max]="5"
            [units]="'stars'"
            [angleSpan]="240"
            [startAngle]="-120">
          </ngx-charts-gauge>
          <button mat-flat-button class="button" (click)="downloadPDF(event.eventCard.eventId, event.eventCard.name.toString + '')" type="submit"><mat-icon>download</mat-icon>Download</button>
        </div>
      </div>
    </div>


  </div>

  <div class = "paginator_container">
    <mat-paginator
      [length]="totalCount"
      [pageSize]="pageSize"
      [pageSizeOptions]="[1, 2, 5, 10]"
      aria-label="Select page"
      (page)="onPageChange($event)"
    />
  </div>


</div>
